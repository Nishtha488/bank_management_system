{% extends "base.html" %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h2>Dashboard</h2>
    <div>
        <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#depositModal">
            <i class="fas fa-plus-circle me-1"></i>Deposit
        </button>
        <button class="btn btn-outline-primary ms-2" data-bs-toggle="modal" data-bs-target="#withdrawModal">
            <i class="fas fa-minus-circle me-1"></i>Withdraw
        </button>
    </div>
</div>

<div class="row">
    {% for account in accounts %}
    <div class="col-md-6 mb-4">
        <div class="card h-100">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5 class="mb-0">{{ account.account_type }} Account</h5>
                <span class="badge bg-success">Active</span>
            </div>
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h6 class="card-subtitle text-muted">Account Number</h6>
                    <span class="text-muted">{{ account.account_number }}</span>
                </div>
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h6 class="card-subtitle text-muted">Balance</h6>
                    <span class="fs-4 fw-bold text-primary">${{ "%.2f"|format(account.balance) }}</span>
                </div>
                <div class="d-grid gap-2">
                    <a href="{{ url_for('transactions', account_id=account.id) }}" class="btn btn-outline-primary">
                        <i class="fas fa-history me-1"></i>View Transactions
                    </a>
                </div>
            </div>
        </div>
    </div>
    {% endfor %}
</div>

<!-- Deposit Modal -->
<div class="modal fade" id="depositModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Deposit Funds</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="depositForm">
                    <div class="mb-3">
                        <label for="depositAccount" class="form-label">Select Account</label>
                        <select class="form-select" id="depositAccount" name="account_id" required>
                            {% for account in accounts %}
                            <option value="{{ account.id }}">{{ account.account_number }} ({{ account.account_type }})</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="depositAmount" class="form-label">Amount</label>
                        <input type="number" step="0.01" class="form-control" id="depositAmount" name="amount" required>
                    </div>
                    <div class="mb-3">
                        <label for="depositDescription" class="form-label">Description (Optional)</label>
                        <input type="text" class="form-control" id="depositDescription" name="description">
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" id="depositSubmit">Deposit</button>
            </div>
        </div>
    </div>
</div>

<!-- Withdraw Modal -->
<div class="modal fade" id="withdrawModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Withdraw Funds</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="withdrawForm">
                    <div class="mb-3">
                        <label for="withdrawAccount" class="form-label">Select Account</label>
                        <select class="form-select" id="withdrawAccount" name="account_id" required>
                            {% for account in accounts %}
                            <option value="{{ account.id }}">{{ account.account_number }} ({{ account.account_type }})</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="withdrawAmount" class="form-label">Amount</label>
                        <input type="number" step="0.01" class="form-control" id="withdrawAmount" name="amount" required>
                    </div>
                    <div class="mb-3">
                        <label for="withdrawDescription" class="form-label">Description (Optional)</label>
                        <input type="text" class="form-control" id="withdrawDescription" name="description">
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" id="withdrawSubmit">Withdraw</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    document.getElementById('depositSubmit').addEventListener('click', function() {
        const formData = new FormData(document.getElementById('depositForm'));
        
        fetch('{{ url_for("deposit") }}', {
            method: 'POST',
            body: formData
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                alert('Deposit successful!');
                location.reload();
            } else {
                alert('Error: ' + data.message);
            }
        })
        .catch(error => {
            alert('An error occurred. Please try again.');
        });
    });
    
    document.getElementById('withdrawSubmit').addEventListener('click', function() {
        const formData = new FormData(document.getElementById('withdrawForm'));
        
        fetch('{{ url_for("withdraw") }}', {
            method: 'POST',
            body: formData
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                alert('Withdrawal successful!');
                location.reload();
            } else {
                alert('Error: ' + data.message);
            }
        })
        .catch(error => {
            alert('An error occurred. Please try again.');
        });
    });
</script>
{% endblock %}